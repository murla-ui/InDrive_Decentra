# InDrive Geoanalytics — документация

> Прототип интерактивной геоаналитики для дорожной безопасности и пропускной способности улично-дорожной сети.

## Что решает модуль безопасности
- **Карта риска возле школ:** Карта риска возле школ. Если на участках дорог рядом со школой есть точки с превышением скорости > 40 км/ч, подсвечиваем их как зоны повышенного риска для детей.
- **Риски во дворах (жилые зоны):** Превышения > 20 км/ч на дорогах в жилых кварталах показывают потенциально опасные дворовые зоны. Классификация дорог взята с OpenStreetMap.
- **Улицы с наибольшим риском аварии:** Отображаем улицы и сегменты, где систематически фиксируются превышения — индикатор повышенной аварийности.
- **Камеры и нарушения.** Показываем расположение камер и участки, где рядом с камерами нарушают чаще всего — где больше фиксируется правонарушений.

## Что решает модуль оптимизации
- **Плотность всех точек:** Теплокарта плотности GPS-точек, показывающая популярные участки дорог — где водители проезжают чаще всего.
- **Старты и финиши:** Карта начальных и конечных точек. Из-за обрезанных маршрутов (небольшой радиус вокруг EXPO) видно, из каких мест заезжают на EXPO и откуда выезжают. Начальные и конечные точки сегментов маршрута определили через **k‑Nearest Neighbors (k‑NN) и minimum spanning tree**  — для каждой поездки.
- **Пропускная способность:** Карта direction clusters на основе векторов движения и графовой структуры: показывает, на каких участках чаще образуются заторы, а где движение более свободное.


###  Очистка и подготовка данных
- Первичная **EDA и cleaning** — в ноутбуке `EDA_Data_Cleaning.ipynb` (описание шагов: проверка координат/дубликатов, фильтрация шумов, нормализация таймстемпов, базовая агрегация по поездкам).
- Для дальнейших стадий используются упрощённые CSV‑извлечения (см. раздел *Структура репозитория*).

## Структура репозитория (основные файлы)
- `index.html` — главная страница‑галерея с переходами на визуализации.
- `Safety.html` — карта риска/инцидентов и контекстные слои (школы, камеры и т. п.).
- `Optimisation.html` — эксперименты с визуализацией потоков/направлений и настройками.
- `schools_expo.csv` — точки школ/соц. объектов для контекста.
- `df_cams.csv` — точки камер наблюдения.
- `final_speed.csv` — агрегаты по скоростям (схема колонок см. в самом файле).
- `direction_clusters.csv` — кластера направлений и/или сводные по потокам.
- `route_endpoints.csv` — рассчитанные старты/финиши по `randomized_id`.
- `safety.bmp`, `business.bmp` — обложки/превью для галереи.
- `route_endpoints.py` — CLI-скрипт для расчёта начала/конца определенного маршрута и (по желанию) heatmap по Астане.

пример запуска
```
python route_endpoints.py /path/to/csv --no-heatmap 
```
<h3>Что делает скрипт</h3>

<ul>
  <li>Читает CSV с GPS-точками: <code>randomized_id</code>, <code>lat</code>, <code>lng</code> <em>(опционально: <code>spd</code> — скорость, <code>azm</code> — азимут)</em>.</li>
  <li>Для каждого <code>randomized_id</code>:
    <ul>
      <li>Переводит координаты в локальные метры (корректная евклидова метрика).</li>
      <li>Строит kNN-граф → минимальное остовное дерево (MST).</li>
      <li>Находит <strong>диаметр MST</strong> — две наиболее удалённые точки по кратчайшему пути (геометрические концы «верёвки»).</li>
      <li>По кратчайшему пути между концами строит «хребет» маршрута и различает <strong>Start/End</strong>:
        <ul>
          <li>если есть <code>azm</code> — по совпадению азимута с направлением хребта у концов;</li>
          <li>иначе — <em>fallback</em> по скорости <code>spd</code> <em>(старт = более «медленный» конец)</em>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Сохраняет таблицу концов в CSV:</li>
</ul>

<pre><code>randomized_id,start_lat,start_lng,end_lat,end_lng</code></pre>


## Дальнейшие шаги 


## Лицензия и атрибуция
